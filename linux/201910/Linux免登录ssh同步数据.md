# Linux免登录ssh同步数据

记录一下，其实就是非常简单的几个命令。

首先，我们设定场景，服务器A和服务器B，需要的功能是将A的代码或某些文件定时或者在脚本中拷贝到服务器B，也就是A->B的文件拷贝。在这里，我们有两种方式，一种是从A向B推送，另一种是从B向A拉取。今天的文章主要是推送的方式。

> ssh免登录

当然是使用秘钥啦，以A为基础，我们需要在A生成公钥和私钥，然后将A的公钥发送给B，实现A->B的免登录。

```shell

> ssh-keygen
> ssh-copy-id root@B.ip

```

ssh-keygen生成公私钥，这个命令不同过多介绍了。没有特殊需求的直接一路回车即可，然后在/root/.ssh/目录下会生成对应的公私钥。

ssh-copy-id用于将公钥发送给服务器B，会在B/root/.ssh/目录下的authorized_keys文件中添加A的公钥信息。

完成上述步骤后就可以实现A->B的免密登录。可以使用ssh登录一下试试。

> 文件同步 rsync

```shell

> rsync -avr /www/html/ root@B.ip:/www/html/

```

同步A的/www/html/目录下的文件到B的/www/html/目录下。如果没有前面配置的免密，这里会出现需要密码的提示。

> 文件复制 scp

```shell

> scp /www/html/* root@172.16.221.192:/www/html/

```

scp命令是远程的cp命令，所以只是复制的功能，会将所有文件复制一次。而rsync更为强大一些的原因也正是因为它有很多的配置参数，可以只更新修改过的或者不相同的文件。

多主机文件同步一般会使用到的场景包括同步更新代码、附件图片文档的同步存储、文件备份等。只需要这几步简单的配置和命令就可以利用shell脚本自动化的进行同步。比如做了git钩子后在一台主机上pull下来代码可以同步更新其他主机的代码。

